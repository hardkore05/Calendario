<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Calendario de Actividades</title>
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.9/index.global.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.9/index.global.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f8f9fa;
      margin: 0;
      padding: 0;
    }
    #login, #app {
      max-width: 900px;
      margin: 20px auto;
      background: #fff;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    h1, h2 {
      text-align: center;
    }
    .fila {
      margin-bottom: 10px;
    }
    label {
      display: block;
      font-weight: bold;
      margin-bottom: 4px;
    }
    input, select, textarea {
      width: 100%;
      padding: 6px;
      border-radius: 6px;
      border: 1px solid #ccc;
    }
    button {
      background: #007bff;
      color: white;
      border: none;
      padding: 8px 15px;
      border-radius: 8px;
      cursor: pointer;
    }
    button:hover {
      background: #0056b3;
    }
    #calendar {
      margin-top: 20px;
    }
    .acciones button {
      margin-right: 5px;
    }
  </style>
</head>
<body>

  <!-- LOGIN -->
  <div id="login">
    <h2>Acceso al Sistema</h2>
    <input type="number" id="cedula" placeholder="Ingrese su número de cédula" />
    <button id="loginBtn">Ingresar</button>
    <p id="error" style="color:red;"></p>
  </div>

  <!-- APP -->
  <div id="app" style="display:none;">
    <header style="display:flex; justify-content:space-between; align-items:center;">
      <h1>Gestión de Actividades</h1>
      <div>
        <span id="usuarioActivo" style="font-weight:bold;"></span>
        <button id="cerrarSesion">Cerrar sesión</button>
      </div>
    </header>

    <main>
      <section id="formulario">
        <h2>Registrar Actividad</h2>
        <form id="formActividad">
          <div class="fila">
            <label>Oficina:</label>
            <select id="oficina" required>
              <option value="">Seleccione...</option>
              <option>Instancias de Participación</option>
              <option>Salud</option>
              <option>Educación</option>
              <option>Subsidio Bono C</option>
              <option>Casa Mujer Respiro</option>
              <option>Casa del Adulto Mayor</option>
              <option>Alcaldia Local de Engativá</option>
            </select>
          </div>

          <div class="fila">
            <label>Responsable:</label>
            <input type="text" id="responsable" readonly />
          </div>

          <div class="fila"><label>Fecha:</label><input type="date" id="fecha" required /></div>
          <div class="fila"><label>Hora inicio:</label><input type="time" id="horaInicio" required /></div>
          <div class="fila"><label>Hora fin:</label><input type="time" id="horaFin" required /></div>
          <div class="fila"><label>Meta:</label><input type="text" id="meta" required /></div>
          <div class="fila"><label>Participantes:</label><input type="text" id="participantes" required /></div>
          <div class="fila"><label>Población Beneficiada:</label><input type="text" id="poblacion" required /></div>
          <div class="fila"><label>Ubicación (Dirección - Lugar):</label><input type="text" id="ubicacion" required /></div>
          <div class="fila"><label>Requerimientos Logísticos:</label><textarea id="logistica" rows="2" required></textarea></div>
          <div class="fila"><label>Descripción:</label><textarea id="descripcion" rows="2" required></textarea></div>

          <button type="submit" id="guardarBtn">Guardar Actividad</button>
        </form>
      </section>

      <section id="calendario">
        <div id="calendar"></div>
        <div id="detalleDia">
          <h3>Actividades del día seleccionado</h3>
          <ul id="listaEventos"></ul>
        </div>
      </section>
    </main>
  </div>

  <script>
    const usuarios = {
      "80772128": { nombre: "Víctor Hugo Huertas Prada", oficina: "Alcaldia Local de Engativá", rol: "admin" },
      "1057581626": { nombre: "Samuel Camacho", oficina: "Alcaldia Local de Engativá", rol: "admin" },
      "1234567890": { nombre: "María López", oficina: "Instancias de Participación", rol: "user" }
    };

    let usuarioActivo = null;
    const login = document.getElementById("login");
    const app = document.getElementById("app");
    const error = document.getElementById("error");
    const cedulaInput = document.getElementById("cedula");
    const responsableInput = document.getElementById("responsable");
    const oficinaSelect = document.getElementById("oficina");
    const usuarioSpan = document.getElementById("usuarioActivo");

    document.getElementById("loginBtn").addEventListener("click", () => {
      const cedula = cedulaInput.value.trim();
      if (usuarios[cedula]) {
        usuarioActivo = { cedula, ...usuarios[cedula] };
        login.style.display = "none";
        app.style.display = "block";
        responsableInput.value = usuarioActivo.nombre;
        usuarioSpan.textContent = usuarioActivo.nombre;
      } else {
        error.textContent = "Cédula no registrada.";
      }
    });

    document.getElementById("cerrarSesion").addEventListener("click", () => {
      usuarioActivo = null;
      app.style.display = "none";
      login.style.display = "block";
      cedulaInput.value = "";
    });

    oficinaSelect.addEventListener("change", () => {
      if (usuarioActivo) responsableInput.value = usuarioActivo.nombre;
    });

    const calendarEl = document.getElementById("calendar");
    const calendar = new FullCalendar.Calendar(calendarEl, {
      initialView: "dayGridMonth",
      locale: "es",
      dateClick: (info) => mostrarEventos(info.dateStr),
    });
    calendar.render();

    function cargarActividades() {
      return JSON.parse(localStorage.getItem("actividades") || "[]");
    }

    function guardarActividades(actividades) {
      localStorage.setItem("actividades", JSON.stringify(actividades));
      actualizarCalendario();
    }

    function actualizarCalendario() {
      const actividades = cargarActividades();
      calendar.removeAllEvents();
      actividades.forEach(a => {
        calendar.addEvent({
          title: `${a.responsable} - ${a.descripcion}`,
          start: a.fecha
        });
      });
    }

    function mostrarEventos(fecha) {
      const lista = document.getElementById("listaEventos");
      lista.innerHTML = "";
      const actividades = cargarActividades().filter(a => a.fecha === fecha);

      actividades.forEach((a, i) => {
        const li = document.createElement("li");
        li.innerHTML = `
          <b>${a.descripcion}</b> (${a.horaInicio} - ${a.horaFin})<br>
          <i>${a.meta}</i><br>
          <b>Participantes:</b> ${a.participantes}<br>
          <b>Ubicación:</b> ${a.ubicacion}<br>
          <b>Estado:</b> ${a.estado || "Pendiente"}<br>
        `;
        const div = document.createElement("div");
        div.classList.add("acciones");

        if (usuarioActivo.rol === "admin") {
          const aceptar = document.createElement("button");
          aceptar.textContent = "Aceptar";
          aceptar.disabled = a.estado && a.estado !== "Pendiente";
          aceptar.onclick = () => cambiarEstado(a, "Aceptada");

          const rechazar = document.createElement("button");
          rechazar.textContent = "Rechazar";
          rechazar.disabled = a.estado && a.estado !== "Pendiente";
          rechazar.onclick = () => cambiarEstado(a, "Rechazada");

          const eliminar = document.createElement("button");
          eliminar.textContent = "Eliminar";
          eliminar.onclick = () => eliminarActividad(a);

          div.append(aceptar, rechazar, eliminar);
        }
        li.append(div);
        lista.append(li);
      });
    }

    function cambiarEstado(actividad, nuevoEstado) {
      const actividades = cargarActividades();
      const index = actividades.findIndex(a => a.fecha === actividad.fecha && a.descripcion === actividad.descripcion);
      if (index !== -1) {
        actividades[index].estado = nuevoEstado;
        guardarActividades(actividades);
        mostrarEventos(actividad.fecha);
      }
    }

    function eliminarActividad(actividad) {
      const actividades = cargarActividades();
      const filtradas = actividades.filter(a => !(a.fecha === actividad.fecha && a.descripcion === actividad.descripcion));
      guardarActividades(filtradas);
      mostrarEventos(actividad.fecha);
    }

    document.getElementById("formActividad").addEventListener("submit", (e) => {
      e.preventDefault();
      const actividad = {
        oficina: oficinaSelect.value,
        responsable: responsableInput.value,
        fecha: document.getElementById("fecha").value,
        horaInicio: document.getElementById("horaInicio").value,
        horaFin: document.getElementById("horaFin").value,
        descripcion: document.getElementById("descripcion").value,
        meta: document.getElementById("meta").value,
        participantes: document.getElementById("participantes").value,
        poblacion: document.getElementById("poblacion").value,
        ubicacion: document.getElementById("ubicacion").value,
        logistica: document.getElementById("logistica").value,
        estado: "Pendiente"
      };

      const actividades = cargarActividades();
      actividades.push(actividad);
      guardarActividades(actividades);
      e.target.reset();
      actualizarCalendario();
      alert("Actividad guardada exitosamente.");
    });

    actualizarCalendario();
  </script>
</body>
</html>








